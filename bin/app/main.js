"use strict";var __=__||{};function bindEvent(a,e,t){var i=$("#app").data("listners")||{};i[a+"|"+e]||(i[a+"|"+e]={name:a,event:e},$("#app").data("listners",i),$(document).on(e,a,t))}function unbindEvent(a,e){var t=$("#app").data("listners")||{};delete t[a+"|"+e],$("#app").data("listners",t),$(document).off(e,a)}function decodeData(m){var v=[],u={};return $.each(m.p,function(a,e){var t,i,n,o,s,r,c,l,p,d={id:e[7],point:[e[15],e[0]],price:{from:-1<e[13]?e[13]:null,to:-1<e[14]?e[14]:null},name:m.n[e[17]],readyDate:e[6]?e[6]:null,type:-1<e[16]?m.t[e[16]]:null,class:-1<e[18]?m.k[e[18]]:null,car:{distance:e[1],time:{h:e[2],m:e[3]}},moscow:{distance:e[8]},railroad:{distance:e[4],closest:(c=m.r,l=e[5],p={},$.each(c,function(a,e){l==e[0]&&(p={id:e[0],name:e[2],point:[e[1],e[3]],distance:e[4],time:{h:e[5],m:e[6]}})}),p)},city:{distance:e[11],closest:(o=m.c,s=e[12],r={},$.each(o,function(a,e){s==e[0]&&(r={id:e[0],name:e[2],point:[e[1],e[3]]})}),r)},eco:{distance:e[9],closest:(t=m.e,i=e[10],n={},$.each(t,function(a,e){i==e[0]&&(n={id:e[0],name:e[2],point:[e[1],e[3]],type:e[4]},u[n.id]=n)}),n)},canvas:{visible:!0}};v.push(d)}),{places:v,eco:u}}L.CanvasOverlay=L.Class.extend({initialize:function(a,e){this._userDrawFunc=a,L.setOptions(this,e)},drawing:function(a){return this._userDrawFunc=a,this},params:function(a){return L.setOptions(this,a),this},canvas:function(){return this._canvas},redraw:function(){return this._frame||(this._frame=L.Util.requestAnimFrame(this._redraw,this)),this},onAdd:function(a){this._map=a,this._canvas=L.DomUtil.create("canvas","leaflet-heatmap-layer");var e=this._map.getSize();this._canvas.width=e.x,this._canvas.height=e.y;var t=this._map.options.zoomAnimation&&L.Browser.any3d;L.DomUtil.addClass(this._canvas,"leaflet-zoom-"+(t?"animated":"hide")),a._panes.overlayPane.appendChild(this._canvas),a.on("moveend",this._reset,this),a.on("resize",this._resize,this),a.options.zoomAnimation&&L.Browser.any3d&&a.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(a){a.getPanes().overlayPane.removeChild(this._canvas),a.off("moveend",this._reset,this),a.off("resize",this._resize,this),a.options.zoomAnimation&&a.off("zoomanim",this._animateZoom,this),this_canvas=null},addTo:function(a){return a.addLayer(this),this},_resize:function(a){this._canvas.width=a.newSize.x,this._canvas.height=a.newSize.y},_reset:function(){var a=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._canvas,a),this._redraw()},_redraw:function(){var a=this._map.getSize(),e=this._map.getBounds(),t=180*a.x/(20037508.34*(e.getEast()-e.getWest())),i=this._map.getZoom();this._userDrawFunc&&this._userDrawFunc(this,{canvas:this._canvas,bounds:e,size:a,zoomScale:t,zoom:i,options:this.options}),this._frame=null},_animateZoom:function(a){var e=this._map.getZoomScale(a.zoom),t=this._map._getCenterOffset(a.center)._multiplyBy(-e).subtract(this._map._getMapPanePos());this._canvas.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(t)+" scale("+e+")"}}),L.canvasOverlay=function(a,e){return new L.CanvasOverlay(a,e)},$(function(){var n=L.map("map").setView([55.751244,37.618423],9);L.tileLayer("https://{s}.tiles.mapbox.com/v4/mapbox.dark/{z}/{x}/{y}@2x.png?access_token=pk.eyJ1IjoiZ2xlYWZsZXQiLCJhIjoiY2lxdWxoODl0MDA0M2h4bTNlZ2I1Z3gycyJ9.vrEWCC2nwsGfAYKZ7c4HZA").addTo(n),$("#app").data("browser",__.browserDetect()).addClass(function(){var a=$(this).data("browser");return[a.browserName,a.platform,a.isMobile].join(" ")}),$.get("bin/data/data.json",function(a){var e=decodeData(a);$("#app").data("data",e),$("#map").trigger("renderMap",{data:e}),$("#places").trigger("renderList",{places:e.places,onlyVisible:!1})}),$("#map").click(function(a){var e=$("#app").data("data").places,t=a.offsetX,i=a.offsetY;$.each(e,function(a,e){t>e.canvas.x1&&t<e.canvas.x2&&i>e.canvas.y1&&i<e.canvas.y2&&console.log(i,e)})}).data("map",n).bind("renderMap",function(a,e){var i=this,p=e.data.places,d=e.data.eco,t=L.canvasOverlay().drawing(function(n,a){var o=a.canvas.getContext("2d"),t=$(i).data("map").getZoom();o.clearRect(0,0,a.canvas.width,a.canvas.height),$.each(p,function(a,e){e.canvas.visible&&(e.canvas=__.placePoint({ctx:o,canvasOverlay:n,zoom:t,place:e}))});var s=new Image,r="mobile"==$("#app").data("browser").isMobile?3:2,c={recicle:1,radiation:20*r,factory:40*r,trash:60*r,airport:80*r,power:100*r,water:120*r},l=20*r;s.addEventListener("load",function(){$.each(d,function(a,e){var t=null;"n"==e.type&&(t=c.recicle),"a"==e.type&&(t=c.airport),"w"!=e.type&&"q"!=e.type||(t=c.trash),"r"==e.type&&(t=c.radiation),"o"!=e.type&&"E"!=e.type||(t=c.factory),"s"==e.type&&(t=c.water),"K"!=e.type&&"p"!=e.type||(t=c.power);var i=n._map.latLngToContainerPoint([e.point[1],e.point[0]]);t&&o.drawImage(s,0,t,20*r,20*r,i.x-l/2,i.y-l/2,.65*l,.65*l)})},!1),s.src="source/assets/img/map/pins@".concat(r,"x.png")}).addTo(n);$(i).data("canvas",t)}),$("#places").scroll(function(a){var t=this,e=$(t).find(".place-item").last(),i=(e.attr("id").split("-")[1],$(t).find(".place-item").length);if(!$("#map").data("map").search&&e.offset().top<2*$(window).outerHeight()){var n=$("#app").data("data").places,o=100;$.each(n,function(a,e){if(i<a&&($(t).append(__.placeItem(e)),o--),!o)return!1})}}).bind("renderList",function(a,e){var t=this,i=e.onlyVisible||!1,n=e.places;$(t).empty(),$.each(n,function(a,e){if(i)e.canvas.visible&&$(t).append(__.placeItem(e));else{if(!(a<100))return!1;$(t).append(__.placeItem(e))}})}),$("#place-search").bind("search",function(a,e){__.search({text:$(this).find("input").val()})}).keyup(function(a){var e=a.which;13==e&&a.preventDefault(),32!=e&&13!=e&&188!=e&&186!=e||$(this).trigger("search")}).find("button").click(function(a){$(this).trigger("search")}),$("#change-view").click(function(){"На карте"!=$(this).text()?$(this).text("На карте"):$(this).text("Списком"),$("#main").toggleClass("main_screen-2")})}),__.browserDetect=function(){navigator.appVersion;var a,e,t,i=navigator.userAgent,n=navigator.appName,o=""+parseFloat(navigator.appVersion),s=parseInt(navigator.appVersion,10);-1!=(e=i.indexOf("Opera"))?(n="opera",o=i.substring(e+6),-1!=(e=i.indexOf("Version"))&&(o=i.substring(e+8))):-1!=(e=i.indexOf("MSIE"))?(n="ie",o=i.substring(e+5)):-1!=(e=i.indexOf("Chrome"))?(n="chrome",o=i.substring(e+7)):-1!=(e=i.indexOf("Safari"))?(n="safari",o=i.substring(e+7),-1!=(e=i.indexOf("Version"))&&(o=i.substring(e+8))):-1!=(e=i.indexOf("Firefox"))?(n="firefox",o=i.substring(e+8)):-1!=i.indexOf("FBAN")&&-1!=i.indexOf("FBAV")?(n="facebook",o=0):(a=i.lastIndexOf(" ")+1)<(e=i.lastIndexOf("/"))&&(n=i.substring(a,e),o=i.substring(e+1),n.toLowerCase()==n.toUpperCase()&&(n=navigator.appName)),-1!=(t=o.indexOf(";"))&&(o=o.substring(0,t)),-1!=(t=o.indexOf(" "))&&(o=o.substring(0,t)),s=parseInt(""+o,10),isNaN(s)&&(o=""+parseFloat(navigator.appVersion),s=parseInt(navigator.appVersion,10));var r,c,l=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,p=window.devicePixelRatio||1,d=window.screen.width*p,m=window.screen.height*p;return{browserName:n.toLowerCase(),fullVersion:o,majorVersion:s,appName:navigator.appName.toLowerCase(),userAgent:navigator.userAgent.toLowerCase(),platform:navigator.platform.toLowerCase(),iphoneX:l&&1125==d&&2436===m?"iphoneX":"",isMobile:(c="not-mobile",r=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(r)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(r.substr(0,4)))&&(c="mobile"),c)}},__.cost=function(a){var e=a.value;return e=/\.\d/.test(e)?e+"":e+".00",(e=(e=/\.\d{2}/.test(e)?e:e+"0").replace(/\d(?=(\d{3})+\.)/g,"$& ")).split(".")},__.placeItem=function(a){var e,t,i=(e=a.price,{from:(t={from:e.from?"undefined"!=typeof global?global.component("cost",{value:e.from})[0]:__.cost({value:e.from})[0]:"",to:e.to?"undefined"!=typeof global?global.component("cost",{value:e.to})[0]:__.cost({value:e.to})[0]:""}).from?"от ".concat(t.from," руб."):"",to:t.to?"до ".concat(t.to," руб."):""}),n="undefined"!=typeof global?"#fafafa":a.canvas.color,o=a.type?'<span class="place-item__type">'.concat(a.type,"</span>"):"",s=(a.eco.distance<10&&"<div>".concat(a.eco.closest.name," в ").concat(a.eco.distance,"км</div>"),'<div class="place-item__car">до Москвы: '.concat(a.car.time.h,"ч ").concat(a.car.time.m,"мин (").concat(a.car.distance,"км)</div>")),r=a.railroad.distance<3?'<div class="place-item__train">ст. '.concat(a.railroad.closest.name," в ").concat(a.railroad.distance,"км,<br>до Москвы: ").concat(a.railroad.closest.time.h,"ч ").concat(a.railroad.closest.time.m,"мин (").concat(a.railroad.closest.distance,"км)</div>"):"",c='<div class="place-item" id="place-'.concat(a.id,'"> <div class="place-item__title"> <div class="place-item__pin" style="background:').concat(n,'"></div> <div> ').concat(o,'<span class="place-item__name">').concat(a.name,'</span> </div> </div> <div class="place-item__price">').concat(i.from," ").concat(i.to,'</div> <div class="place-item__distance"> ').concat(s," ").concat(r," </div></div>");return"undefined"==typeof global&&bindEvent(".place-item","click",function(a){var e=$("#app").data("data").places,t=$("#map").data("map"),i=$(a.currentTarget).attr("id").split("-")[1];$.each(e,function(a,e){if(e.id==i)return t.setView(new L.LatLng(e.point[1],e.point[0]),14),!1})}),c},__.colorize=function(a){function n(a,e,t,i){return"rgba(".concat(a,",").concat(e,",").concat(t,",").concat(i,")")}function o(a,e,t,i,n){return i+(t-a)/(e-a)*((n-i)/1)}function s(a,e){var t=[];return t[3]=1-(1-e[3])*(1-a[3]),t[0]=Math.round(e[0]*e[3]/t[3]+a[0]*a[3]*(1-e[3])/t[3]),t[1]=Math.round(e[1]*e[3]/t[3]+a[1]*a[3]*(1-e[3])/t[3]),t[2]=Math.round(e[2]*e[3]/t[3]+a[2]*a[3]*(1-e[3])/t[3]),t}return this.eco=function(a){var e=10;switch(a.eco.closest.type){case"K":case"p":e=3;break;case"n":e=5}var t=a.eco.distance,i=s([0,98,255,.3],[255,30,0,t<e?.6-o(0,e,t,0,.6):0]);return n(i[0],i[1],i[2],i[3])},this.railroad=function(a){var e=a.railroad.distance,t=s([255,30,0,.1],[0,98,255,e<3?1-o(0,3,e,0,1):0]);return n(t[0],t[1],t[2],t[3])},this.car=function(a){var e=s([255,30,0,.1],[0,98,255,.3-o(10,200,a.car.distance,0,.3)]);return n(e[0],e[1],e[2],e[3])},this},__.placePoint=function(a){var e=2*{0:{s:.5},1:{s:.5},2:{s:.5},3:{s:1},4:{s:1},5:{s:2},6:{s:2},7:{s:3},8:{s:3},9:{s:3},10:{s:4},11:{s:4},12:{s:4},13:{s:6},14:{s:6},15:{s:6},16:{s:12},17:{s:12},18:{s:12}}[a.zoom].s,t=__.colorize().eco(a.place);a.ctx.fillStyle=t;var i=a.canvasOverlay._map.latLngToContainerPoint([a.place.point[1],a.place.point[0]]);return a.ctx.beginPath(),a.ctx.arc(i.x,i.y,e/2,0,2*Math.PI),a.ctx.fill(),a.ctx.closePath(),{x1:i.x,y1:i.y,x2:i.x+e,y2:i.y+e,color:t,visible:a.place.canvas.visible}},__.search=function(a){var e=$("#app").data("data").places,t=a.text.toLowerCase().trim(),i=[],n=$("#map").data("map");return a.text?($.each(e,function(a,e){-1!==e.name.toLowerCase().trim().indexOf(t)?(e.canvas.visible=!0,i.push(e)):e.canvas.visible=!1}),i.length?n.search=!0:n.search=!1,$("#places").trigger("renderList",{places:e,onlyVisible:!0}).scrollTop(0)):(n.search=!1,$.each(e,function(a,e){e.canvas.visible=!0}),$("#places").trigger("renderList",{places:e,onlyVisible:!1})),$("#map").data("canvas").redraw(),i};
//# sourceMappingURL=main.js.map
